{
  "rules": {
    ".read": "auth.token.isAdmin === true || root.child('usuarios').child(auth.uid).child('funcao').val() == 'ADMIN'",
    ".write": "auth.token.isAdmin === true",

    "usuarios": {
      "$uid": {
        ".read": "$uid === auth.uid || root.child('usuarios').child(auth.uid).child('funcao').val() === 'ADMIN'",
        ".write": "$uid === auth.uid || root.child('usuarios').child(auth.uid).child('funcao').val() === 'ADMIN'",
        ".validate": "newData.hasChildren(['nome', 'email', 'funcao','numero', 'situacao'])",
        "funcao": {
          ".validate": "newData.val() === 'ADMIN' || newData.val() === 'GARCOM' || newData.val() === 'MESA'"
        },
        "situacao": {
          ".validate": "newData.val() === 'ATIVO' || newData.val() === 'INATIVO' || newData.val() === 'OCUPADO'"
        }
      }
    },

    "comandas": {
      ".read": "auth.token !== null && (root.child('usuarios').child(auth.uid).child('funcao').val() == 'ADMIN' || root.child('usuarios').child(auth.uid).child('funcao').val() == 'GARCOM' || root.child('usuarios').child(auth.uid).child('funcao').val() == 'MESA')",
      ".write": "auth.token !== null && (root.child('usuarios').child(auth.uid).child('funcao').val() == 'ADMIN' || root.child('usuarios').child(auth.uid).child('funcao').val() == 'GARCOM')",
      ".indexOn": ["codigo", "mesa, garcom"],
      "$uidMesa": {
        ".read": "$uidMesa === auth.uid || root.child('usuarios').child(auth.uid).child('funcao').val() == 'ADMIN'",
        ".write": "$uidMesa === auth.uid || root.child('usuarios').child(auth.uid).child('funcao').val() == 'ADMIN' || (root.child('usuarios').child(auth.uid).child('funcao').val() == 'GARCOM' && newData.child('garcom').val() === auth.uid)",

        "$uid": {
          ".validate": "newData.hasChildren(['codigo','subtotal', 'total', 'data_hora', 'taxa_servico','situacao', 'mesa', 'garcom', 'pedidos'])",
          "garcom": {
            ".validate": "root.child('usuarios').child(auth.uid).child('funcao').val() == 'ADMIN' || newData.val() === data.val() || root.child('usuarios').child(auth.uid).child('funcao').val() == 'GARCOM'"
          },
          "pedidos": {
            "$uidPedido": {
              ".write": "root.child('usuarios').child(auth.uid).child('funcao').val() === 'MESA' || (root.child('usuarios').child(auth.uid).child('funcao').val() === 'ADMIN' || data.parent().parent().child('garcom').val() === auth.uid)",
              ".validate": "newData.hasChildren(['produtoId', 'quantidade']) && newData.child('quantidade').isNumber() && newData.child('quantidade').val() > 0"
            }
          }
        }
      }
    },

    "produtos": {
      ".read": "auth.token !== null",
      ".write": "auth.token !== null && root.child('usuarios').child(auth.uid).child('funcao').val() == 'ADMIN'",
      ".indexOn": ["nome", "tipo", "situacao"],
      "$uid": {
        ".validate": "newData.hasChildren(['nome', 'descricao', 'preco_base', 'tipo', 'situacao'])",
        "preco": {
          ".validate": "newData.val() > 0"
        }
      },
      "pedidos": {
        "$uidPedido": {
          "produtos": {
            "$uidProduto": {
              ".write": "root.child('usuarios').child(auth.uid).child('funcao').val() === 'MESA' || (root.child('usuarios').child(auth.uid).child('funcao').val() === 'ADMIN' || data.parent().parent().child('garcom').val() === auth.uid)",
              ".validate": "newData.hasChildren(['quantidade', 'subtotal']) && newData.child('quantidade').isNumber() && newData.child('quantidade').val() > 0"
            }
          }
        }
      }
    }
  }
}
