{
  "rules": {
    ".read": "auth.token.isAdmin === true || root.child('usuarios').child(auth.uid).child('funcao').val() == 'ADMIN'",
    ".write": "auth.token.isAdmin === true",

    "usuarios": {
      ".indexOn": ["cpf"],
      "$uid": {
        ".read": "$uid === auth.uid || root.child('usuarios').child(auth.uid).child('funcao').val() === 'ADMIN'",
        ".write": "$uid === auth.uid || root.child('usuarios').child(auth.uid).child('funcao').val() === 'ADMIN'",
        ".validate": "newData.hasChildren(['cpf','nome', 'email', 'funcao'])",
        "funcao": {
          ".validate": "newData.val() === 'ADMIN' || newData.val() === 'CLIENTE'"
        }
      }
    },
    "clientes": {
      ".indexOn": ["cpf", "endereco"],
      "$uid": {
        ".read": "$uid === auth.uid || root.child('usuarios').child(auth.uid).child('funcao').val() === 'ADMIN'",
        ".write": "$uid === auth.uid || root.child('usuarios').child(auth.uid).child('funcao').val() === 'ADMIN'",
        ".validate": "newData.hasChildren(['cpf','nome', 'email'])"
      }
    },
    "enderecos": {
      ".indexOn": ["cep"],
      ".read": "$uid === auth.uid || root.child('usuarios').child(auth.uid).child('funcao').val() === 'ADMIN'",
      ".write": "$uid === auth.uid || root.child('usuarios').child(auth.uid).child('funcao').val() === 'ADMIN'",
      "$uid": {
        ".validate": "newData.hasChildren(['cep','rua', 'numero', 'bairro', 'cidade', 'estado'])"
      }
    },
    "pedidos": {
      ".read": "auth.token !== null",
      ".write": "auth.token.isAdmin === true || root.child('usuarios').child(auth.uid).child('funcao').val() === 'ADMIN'",
      "indexOn": ["codigo", "cliente", "endereco"],
      "$uid": {
        ".validate": "newData.hasChildren(['codigo', 'data', 'situacao', 'subtotal', 'total', 'taxaServico'])",
        "situacao": {
          ".validate": "newData.val() === 'NOVO' || newData.val() === 'EM_PREPARACAO' || newData.val() === 'EM_ENTREGA' || newData.val() === 'CANCELADO' || newData.val() === 'ENTREGUE'"
        },
        "cliente": {
          ".validate": "root.child('clientes').child(newData.val()).exists()"
        },
        "endereco": {
          ".validate": "root.child('enderecos').child(newData.val()).exists()"
        },
        "produtos": [
          {
            ".indexOn": ["codigo"],
            "$produto": {
              ".validate": "newData.hasChildren(['codigo', 'nome','imagem', 'preco', 'quantidade', 'descricao', 'tipopreco_basesituacao'])",
              "codigo": {
                ".validate": "root.child('produtos').child(newData.val()).exists()"
              },
              "quantidade": {
                ".validate": "newData.val() > 0"
              }
            }
          }
        ]
      }
    }
  }
}
